<Window
    x:Class="NakuruTool.Views.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:behaviors="http://schemas.microsoft.com/xaml/behaviors"
    xmlns:l="http://schemas.livet-mvvm.net/2011/wpf"
    xmlns:v="clr-namespace:NakuruTool.Views"
    xmlns:vm="clr-namespace:NakuruTool.ViewModels"
    xmlns:vc="clr-namespace:NakuruTool.Views.Collection"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    d:DataContext="{d:DesignInstance vm:MainWindowViewModel}"
    Title="{DynamicResource AppTitle}"
    Width="1200"
    MinHeight="900"
    Height="900">

    <Window.DataContext>
        <vm:MainWindowViewModel />
    </Window.DataContext>

    <behaviors:Interaction.Triggers>
        <!--  When ContentRendered event raised, Initialize method of ViewModel would be called.  -->
        <behaviors:EventTrigger EventName="ContentRendered">
            <l:LivetCallMethodAction MethodName="Initialize" MethodTarget="{Binding}" />
        </behaviors:EventTrigger>

        <!--  Dispose method is called, when Window closing.  -->
        <behaviors:EventTrigger EventName="Closed">
            <l:DataContextDisposeAction />
        </behaviors:EventTrigger>


        <!--  If you make user choose 'OK or Cancel' closing Window, then please use Window Close cancel Behavior.  -->

        <!-- ダイアログ表示用のメッセージトリガー -->
        <l:InteractionMessageTrigger MessageKey="ShowSettings" Messenger="{Binding Messenger}">
            <l:TransitionInteractionMessageAction WindowType="{x:Type v:SettingsDialog}" Mode="Modal" IsOwned="True" />
        </l:InteractionMessageTrigger>

    </behaviors:Interaction.Triggers>

    <Grid Background="{DynamicResource WindowBackground}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- ヘッダー部分 -->
        <Grid Grid.Row="0" Margin="10,10,10,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>    <!-- アプリタイトル -->
                <ColumnDefinition Width="*"/>       <!-- スペース -->
                <ColumnDefinition Width="Auto"/>    <!-- 言語選択 -->
                <ColumnDefinition Width="Auto"/>    <!-- 設定ボタン -->
            </Grid.ColumnDefinitions>
            
            <TextBlock Grid.Column="0"
                       Text="{DynamicResource AppTitle}" 
                       FontSize="18" 
                       FontWeight="Bold" 
                       Foreground="{DynamicResource TextForeground}"
                       VerticalAlignment="Center"/>
            
            <ComboBox Grid.Column="2"
                      ItemsSource="{Binding AvailableLanguages}"
                      SelectedValue="{Binding SelectedLanguage}"
                      SelectedValuePath="Code"
                      DisplayMemberPath="DisplayName"
                      Style="{DynamicResource ThemedComboBoxStyle}"
                      ItemContainerStyle="{DynamicResource ThemedComboBoxItemStyle}"
                      MinWidth="120"
                      MaxWidth="150"
                      FontSize="12"
                      Height="28"
                      VerticalAlignment="Center"
                      Margin="0,0,10,0"/>
            
            <Button Grid.Column="3"
                    Content="{DynamicResource Settings}" 
                    Command="{Binding ShowSettingsCommand}"
                    Background="{DynamicResource ButtonBackground}"
                    Foreground="{DynamicResource ButtonForeground}"
                    BorderBrush="{DynamicResource ButtonBorder}"
                    Padding="10,5"
                    MinWidth="80"
                    VerticalAlignment="Center"/>
        </Grid>
        
        <!-- メインコンテンツ部分（タブコントロール） -->
        <TabControl Grid.Row="1" Margin="10,5,10,0"
                   Style="{DynamicResource ThemedTabControlStyle}">
            
            <!-- コレクション管理タブ -->
            <TabItem Header="{DynamicResource Collections}" Name="CollectionTab"
                    DataContext="{Binding CollectionTabViewModel}">
                <Grid Margin="5">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="3*"/>   <!-- メインエリア -->
                        <RowDefinition Height="4*"/>    <!-- 曲リスト -->
                    </Grid.RowDefinitions>

                    <!-- メインエリア -->
                    <vc:CollectionListControl Grid.Row="0" x:Name="CollectionListControl" DataContext="{Binding}"/>
                    
                    <!-- 下部曲リスト -->
                    <vc:BeatmapDetailsControl Grid.Row="1" DataContext="{Binding CollectionBeatmapListViewModel}"/>
                </Grid>
            </TabItem>
            
            <!-- 将来の全曲リストタブ用プレースホルダー（コメントアウト） -->
            <!--
            <TabItem Header="{DynamicResource AllSongs}" Name="AllSongsTab">
                <Grid>
                    <TextBlock Text="将来の全曲リスト機能" 
                               HorizontalAlignment="Center" 
                               VerticalAlignment="Center"
                               FontSize="16"
                               Foreground="{DynamicResource TextForeground}"/>
                </Grid>
            </TabItem>
            -->
            
        </TabControl>
        
        <!-- ステータスバー -->
        <Border Grid.Row="2" 
                Background="{DynamicResource StatusBarBackground}" 
                BorderBrush="{DynamicResource BorderBrush}" 
                BorderThickness="0,1,0,0"
                Padding="10,5">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- ローディングインジケーター -->
                <ProgressBar Grid.Row="0"
                             IsIndeterminate="{Binding IsLoading}"
                             Height="4"
                             Margin="0,0,0,5"
                             Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                
                <!-- ステータスメッセージ -->
                <TextBlock Grid.Row="1"
                           Text="{Binding StatusMessage}" 
                           TextWrapping="Wrap" 
                           FontSize="10"
                           Foreground="{DynamicResource TextForeground}"/>
            </Grid>
        </Border>
    </Grid>
</Window>